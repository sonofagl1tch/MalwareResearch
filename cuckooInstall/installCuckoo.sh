#!/bin/bash

#work in progress and not functioning

# Install the basic dependencies
apt-get install python python-pip python-dev libffi-dev libssl-dev libxml2-dev libxslt1-dev libjpeg-dev python-magic python-dpkt python-mako python-sqlalchemy python-jinja2 python-bottle python-dnspython

#Installing SSDEEP for calculating fuzzy hashes
 #apt-get install ssdeep  
 #apt-get install python-pyrex # required for pyssdeep installation  
 #apt-get install subversion  
 #apt-get install libfuzzy-dev   
 #svn checkout http://pyssdeep.googlecode.com/svn/trunk/ pyssdeep  
 #cd pyssdeep  
 #python setup.py build  
 #python setup.py install # run as root user  

#If you want to use the Django-based web interface, you’ll have to install MongoDB too:
apt-get install mongodb

#In order to properly function, Cuckoo requires some dependencies. They can all be installed through PyPI like this:
#pip install -r requirements.txt # not working becuase idk how to populate the requirements text file


#Yara and Pydeep are optional plugins but will have to be installed manually, so please refer to their websites.
#http://virustotal.github.io/yara/
#https://github.com/kbandla/pydeep

#Installing Yara and Python support
apt-get install g++  
apt-get install libpcre3 libpcre3-dev  
wget https://github.com/VirusTotal/yara/archive/v3.5.0.tar.gz 
tar -xvzf v3.5.0.tar.gz   
cd v3.5.0  
./configure  
make  
make check  
make install # finished yara installation  
#yara-python
pip install yara-python # finished python support installation  

#If you want to use KVM it’s packaged too and you can install it with the following command:
apt-get install qemu-kvm libvirt-bin ubuntu-vm-builder bridge-utils python-libvirt

#If you want to use XenServer you’ll have to install the XenAPI Python package:
#pip install XenAPI

#install dependencies
pip install sqlalchemy requests XenAPI bson distorm3 pefile pycrypto image ObjectId



#If you want to use the mitm auxiliary module (to intercept SSL/TLS generated traffic), you need to install mitmproxy. Please refer to its website for installation instructions.
#https://mitmproxy.org/

#By default Cuckoo adopts tcpdump, the prominent open source solution.
apt-get install tcpdump libcap2-bin

#Tcpdump requires root privileges, but since you don’t want Cuckoo to run as root you’ll have to set specific Linux capabilities to the binary:
setcap cap_net_raw,cap_net_admin=eip /usr/sbin/tcpdump

#You can verify the results of last command with:
#$ getcap /usr/sbin/tcpdump
#/usr/sbin/tcpdump = cap_net_admin,cap_net_raw+eip

#If you don’t have setcap installed you can get it with:
#$ sudo apt-get install libcap2-bin
#Or otherwise (not recommended) do:
#$ sudo chmod +s /usr/sbin/tcpdump

# Installing Volatility
cd ~/Downloads
git clone https://github.com/volatilityfoundation/volatility.git
cd volatility
python setup.py install

#Create a new user:
adduser cuckoo
#use "passwd -d cuckoo" if you accidently set this password

#add groups
addgroup vboxusers 
addgroup cuckoo

#If you’re using VirtualBox, make sure the new user belongs to the “vboxusers” group (or the group you used to run VirtualBox):
usermod -a -G vboxusers cuckoo

#If you’re using KVM or any other libvirt based module, make sure the new user belongs to the “libvirtd” group (or the group your Linux distribution uses to run libvirt):
usermod -a -G libvirtd cuckoo


#install cuckoo-modified
git clone https://github.com/spender-sandbox/cuckoo-modified.git


# start cuckoo
python cuckoo.py

# install signature modules
utils/community.py --force --rewrite --all

#disable firewall for testing
#ufw disable.

#enable firewall
# ufw enable

#configure firewall

